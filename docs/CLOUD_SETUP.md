# 云开发配置说明

## 问题

小程序使用云开发（云数据库、云函数），但未初始化云环境。

## 解决步骤

### 1. 开通云开发

在微信开发者工具中：

1. 点击顶部菜单 **「云开发」**
2. 首次使用会提示「立即开通」，点击开通
3. 选择 **「按量付费」**（新用户有免费额度）
4. 创建云环境，记录环境 ID（类似 `cloud1-xxx`）

### 2. 配置环境 ID

打开 `miniprogram/app.js`，找到第 7 行：

```javascript
wx.cloud.init({
  env: 'your-env-id', // 需要替换为实际的云环境 ID
  traceUser: true
});
```

将 `your-env-id` 替换为你的实际云环境 ID。

### 3. 创建云数据库集合

在云开发控制台中：

1. 点击 **「数据库」**
2. 点击 **「+」** 添加集合
3. 创建以下集合：

| 集合名称 | 说明 |
|---------|------|
| `positions` | 持仓表 |
| `transactions` | 交易记录表 |

4. 权限设置：选择 **「所有用户可读，仅创建者可写」**

### 4. 上传云函数

在云开发控制台中：

1. 点击 **「云函数」**
2. 点击 **「上传部署」** 或右键项目根目录的 `cloudfunctions` 文件夹
3. 部署以下云函数：

```
cloudfunctions/
├── calculate-cost/     # 成本计算
├── get-quote/          # 获取实时行情
└── get-stock-info/     # 获取股票信息
```

4. 每个云函数需要上传并部署

### 5. 验证配置

重新编译项目，打开控制台，应该能看到：

```
持股成本管理助手启动
```

如果没有报错，说明云开发初始化成功。

---

## 免费额度

微信云开发新用户有免费额度：

| 资源 | 免费额度 |
|------|---------|
| 数据库读取 | 5 万次/天 |
| 数据库写入 | 3 万次/天 |
| 云函数调用 | 20 万次/天 |

对于个人使用完全够用。

---

## 常见问题

**Q: 找不到「云开发」按钮？**
A: 确保登录的是小程序开发者账号，并且项目已关联到小程序 AppID。

**Q: 云函数上传失败？**
A: 检查 `project.config.json` 中的 `cloudfunctionRoot` 配置是否正确。

**Q: 数据库操作失败？**
A: 检查集合权限设置，确保允许读写。
