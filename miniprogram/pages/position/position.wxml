<!-- pages/position/position.wxml - 持仓详情页 -->

<view class="container" wx:if="{{!loading && position}}">
  <!-- 持仓信息卡片 -->
  <view class="card">
    <view class="position-header">
      <text class="stock-name">{{position.stockName}}</text>
      <text class="stock-code">{{formatStockCode(position.stockCode, position.region)}}</text>
    </view>

    <view class="position-summary">
      <view class="summary-item">
        <text class="label">持仓数量</text>
        <text class="value">{{position.quantity}}股</text>
      </view>
      <view class="summary-item">
        <text class="label">成本价</text>
        <text class="value">¥{{formatMoney(position.avgCost)}}</text>
      </view>
      <view class="summary-item">
        <text class="label">当前价</text>
        <text class="value {{position.currentPrice > position.avgCost ? 'stock-up' : 'stock-down'}}">
          ¥{{formatMoney(position.currentPrice || '--')}}
        </text>
      </view>
      <view class="summary-item">
        <text class="label">持仓市值</text>
        <text class="value">¥{{formatMoney(position.quantity * (position.currentPrice || position.avgCost))}}</text>
      </view>
    </view>

    <view class="profit-section">
      <view class="profit-header">
        <text class="profit-label">盈亏</text>
        <text class="profit-amount {{getProfitClass(position.quantity * (position.currentPrice || position.avgCost) - position.quantity * position.avgCost)}}">
          {{formatMoney(position.quantity * (position.currentPrice || position.avgCost) - position.quantity * position.avgCost)}}
        </text>
      </view>
      <text class="profit-percent {{getProfitClass(position.quantity * (position.currentPrice || position.avgCost) - position.quantity * position.avgCost)}}">
        {{formatPercent((position.quantity * (position.currentPrice || position.avgCost) - position.quantity * position.avgCost) / (position.quantity * position.avgCost))}}
      </text>
    </view>
  </view>

  <!-- 交易记录 -->
  <view class="card">
    <view class="section-header">
      <text class="section-title">交易记录</text>
      <view class="section-btn" bindtap="onAddTransaction">
        <text>添加记录</text>
      </view>
    </view>

    <view wx:if="{{transactions.length === 0}}" class="empty-state">
      <text class="empty-text">暂无交易记录</text>
    </view>

    <view wx:for="{{transactions}}" wx:key="_id" class="transaction-item">
      <view class="transaction-header">
        <text class="transaction-type {{item.type === 'buy' ? 'type-buy' : 'type-sell'}}">
          {{item.type === 'buy' ? '买入' : '卖出'}}
        </text>
        <text class="transaction-time">{{formatDateTime(item.tradeTime)}}</text>
      </view>

      <view class="transaction-details">
        <view class="detail-row">
          <text class="detail-label">价格</text>
          <text class="detail-value">¥{{formatMoney(item.price)}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">数量</text>
          <text class="detail-value">{{item.quantity}}股</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">金额</text>
          <text class="detail-value">¥{{formatMoney(item.price * item.quantity)}}</text>
        </view>
        <view wx:if="{{item.fee > 0}}" class="detail-row">
          <text class="detail-label">手续费</text>
          <text class="detail-value">¥{{formatMoney(item.fee)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <button class="btn btn-outline" bindtap="onDeletePosition">删除持仓</button>
  </view>
</view>

<view wx:if="{{loading}}" class="loading">
  <text>加载中...</text>
</view>
