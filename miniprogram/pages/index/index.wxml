<!-- pages/index/index.wxml - 持仓列表页 -->

<view class="container">
  <!-- 总资产卡片 -->
  <view class="card summary-card">
    <view class="summary-header">
      <text class="summary-label">总资产</text>
      <text class="summary-value">¥{{formatMoney(totalValue)}}</text>
    </view>
    <view class="summary-details">
      <view class="summary-item">
        <text class="summary-item-label">总成本</text>
        <text class="summary-item-value">¥{{formatMoney(totalCost)}}</text>
      </view>
      <view class="summary-item">
        <text class="summary-item-label">总盈亏</text>
        <text class="summary-item-value {{getProfitClass(totalProfit)}}">
          {{formatMoney(totalProfit)}}
          <text wx:if="{{totalProfit !== 0}}" class="profit-percent">({{formatPercent(totalProfit / totalCost)}})</text>
        </text>
      </view>
    </view>
  </view>

  <!-- 持仓列表 -->
  <view class="card position-list">
    <view wx:if="{{!loading && positions.length === 0}}" class="empty-state">
      <text class="empty-text">暂无持仓</text>
      <text class="empty-hint">点击下方"添加"按钮开始</text>
    </view>

    <view wx:for="{{positions}}" wx:key="_id" class="position-item" bindtap="onViewPosition" data-id="{{item._id}}">
      <view class="position-header">
        <view class="position-info">
          <text class="position-name">{{item.stockName}}</text>
          <text class="position-code">{{formatStockCode(item.stockCode, item.region)}}</text>
        </view>
        <view class="position-value">
          <text class="value-amount">¥{{formatMoney(item.quantity * (item.currentPrice || item.avgCost))}}</text>
        </view>
      </view>

      <view class="position-details">
        <view class="detail-item">
          <text class="detail-label">持仓</text>
          <text class="detail-value">{{item.quantity}}股</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">成本价</text>
          <text class="detail-value">¥{{formatMoney(item.avgCost)}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">现价</text>
          <text class="detail-value {{item.currentPrice > item.avgCost ? 'stock-up' : 'stock-down'}}">
            ¥{{formatMoney(item.currentPrice || '--')}}
          </text>
        </view>
        <view class="detail-item">
          <text class="detail-label">盈亏</text>
          <text class="detail-value {{getProfitClass(item.quantity * (item.currentPrice || item.avgCost) - item.quantity * item.avgCost)}}">
            {{formatMoney(item.quantity * (item.currentPrice || item.avgCost) - item.quantity * item.avgCost)}}
          </text>
        </view>
      </view>
    </view>

    <view wx:if="{{loading}}" class="loading">
      <text>加载中...</text>
    </view>
  </view>
</view>
