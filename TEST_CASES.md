# 测试用例文档

## 功能测试清单

### 1. 持仓列表页面（pages/index）

#### 测试用例 1.1：页面加载
- **前置条件：** 用户已登录
- **操作步骤：** 打开小程序，进入持仓列表页
- **预期结果：**
  - 页面正常显示
  - 显示「暂无持仓」提示（如果数据库为空）
  - 底部 tabBar 正常显示

#### 测试用例 1.2：显示持仓列表
- **前置条件：** 数据库中已有持仓数据
- **操作步骤：** 打开持仓列表页
- **预期结果：**
  - 显示所有持仓卡片
  - 每个卡片显示：股票名称、代码、持仓数量、成本价、当前价、盈亏金额、盈亏百分比
  - 涨跌颜色正确（红涨绿跌）

#### 测试用例 1.3：下拉刷新
- **前置条件：** 在持仓列表页
- **操作步骤：** 下拉页面
- **预期结果：**
  - 显示刷新动画
  - 获取最新行情数据
  - 刷新后数据更新

#### 测试用例 1.4：点击持仓详情
- **前置条件：** 持仓列表有数据
- **操作步骤：** 点击任意持仓卡片
- **预期结果：**
  - 跳转到持仓详情页
  - 正确传递股票代码参数

---

### 2. 持仓详情页面（pages/position）

#### 测试用例 2.1：页面加载
- **前置条件：** 传入股票代码参数
- **操作步骤：** 打开持仓详情页
- **预期结果：**
  - 显示股票基本信息
  - 显示交易记录列表
  - 显示盈亏统计

#### 测试用例 2.2：交易记录显示
- **前置条件：** 股票有交易记录
- **操作步骤：** 查看交易记录列表
- **预期结果：**
  - 按时间倒序显示
  - 显示交易类型（买入/卖出）、价格、数量、手续费、时间

#### 测试用例 2.3：删除持仓
- **前置条件：** 在持仓详情页
- **操作步骤：** 点击删除按钮，确认删除
- **预期结果：**
  - 弹出确认对话框
  - 确认后持仓被删除
  - 跳转回持仓列表

---

### 3. 添加持仓页面（pages/add-position）

#### 测试用例 3.1：添加 A 股
- **前置条件：** 在添加持仓页
- **操作步骤：**
  - 选择市场：沪深 A 股
  - 输入股票代码：600000
  - 输入价格：10.00
  - 输入数量：100
  - 输入手续费：5.00
  - 点击提交
- **预期结果：**
  - 获取股票信息成功
  - 创建持仓记录
  - 创建交易记录
  - 跳转到持仓列表

#### 测试用例 3.2：添加港股
- **前置条件：** 在添加持仓页
- **操作步骤：**
  - 选择市场：港股
  - 输入股票代码：00700
  - 输入价格：350.00
  - 输入数量：100
  - 输入手续费：10.00
  - 点击提交
- **预期结果：**
  - 获取股票信息成功
  - 创建持仓记录
  - 创建交易记录

#### 测试用例 3.3：输入验证
- **前置条件：** 在添加持仓页
- **操作步骤：**
  - 不输入股票代码，点击提交
- **预期结果：**
  - 显示错误提示「请输入股票代码」

#### 测试用例 3.4：已存在持仓
- **前置条件：** 已添加持仓 600000
- **操作步骤：** 再次添加持仓 600000
- **预期结果：**
  - 显示提示「该股票已存在持仓」
  - 不创建重复持仓

---

### 4. 交易记录页面（pages/transaction）

#### 测试用例 4.1：显示所有交易记录
- **前置条件：** 数据库有交易记录
- **操作步骤：** 打开交易记录页
- **预期结果：**
  - 显示所有交易记录
  - 按时间倒序排列
  - 显示股票名称、代码、交易类型、数量、价格、时间

#### 测试用例 4.2：筛选功能（如已实现）
- **前置条件：** 有不同股票的交易记录
- **操作步骤：** 筛选特定股票
- **预期结果：**
  - 只显示该股票的交易记录

---

### 5. 设置页面（pages/settings）

#### 测试用例 5.1：显示用户信息
- **前置条件：** 用户已登录
- **操作步骤：** 打开设置页
- **预期结果：**
  - 显示用户头像和昵称
  - 显示统计信息（持仓数、总资产、总盈亏）

#### 测试用例 5.2：关于页面
- **操作步骤：** 点击「关于」
- **预期结果：**
  - 显示版本信息
  - 显示项目说明

---

### 6. 成本计算测试

#### 测试用例 6.1：首次买入
- **操作：** 买入 600000，价格 10.00，数量 100，手续费 5.00
- **预期结果：**
  - 成本价 = (10.00 × 100 + 5.00) / 100 = 10.05

#### 测试用例 6.2：加仓（二次买入）
- **前置条件：** 已有持仓，成本价 10.05，数量 100
- **操作：** 再买入 100 股，价格 11.00，手续费 5.00
- **预期结果：**
  - 新成本价 = (10.05 × 100 + 11.00 × 100 + 5.00) / 200 = 10.55

#### 测试用例 6.3：卖出（不影响成本价）
- **前置条件：** 持仓 200 股，成本价 10.55
- **操作：** 卖出 100 股，价格 12.00，手续费 5.00
- **预期结果：**
  - 成本价仍为 10.55
  - 盈亏 = (12.00 - 5.00/100 - 10.55) × 100 = 140.00

#### 测试用例 6.4：清仓后重新买入
- **前置条件：** 持仓 100 股，成本价 10.55
- **操作：** 卖出全部 100 股，重新买入 100 股，价格 9.00，手续费 5.00
- **预期结果：**
  - 新成本价 = (9.00 × 100 + 5.00) / 100 = 9.05

---

### 7. 云函数测试

#### 测试用例 7.1：get-quote（获取实时报价）
- **输入：** `{"code": "600000"}`
- **预期结果：**
  ```json
  {
    "code": 0,
    "data": {
      "code": "600000",
      "name": "浦发银行",
      "price": 10.50,
      "change": 0.30,
      "changePercent": 2.94,
      "timestamp": 1234567890
    }
  }
  ```

#### 测试用例 7.2：get-stock-info（获取股票信息）
- **输入：** `{"code": "600000", "region": "cn"}`
- **预期结果：**
  ```json
  {
    "code": 0,
    "data": {
      "code": "600000",
      "name": "浦发银行",
      "market": "沪A",
      "industry": "银行"
    }
  }
  ```

#### 测试用例 7.3：无效股票代码
- **输入：** `{"code": "999999"}`
- **预期结果：**
  ```json
  {
    "code": -1,
    "message": "股票代码不存在"
  }
  ```

---

## 性能测试

### 测试用例 8.1：大量持仓数据
- **前置条件：** 数据库中有 50 只以上持仓
- **操作：** 打开持仓列表
- **预期结果：**
  - 页面加载时间 < 2 秒
  - 下拉刷新流畅

### 测试用例 8.2：大量交易记录
- **前置条件：** 某只股票有 100 条以上交易记录
- **操作：** 打开持仓详情
- **预期结果：**
  - 交易记录加载正常
  - 滚动流畅

---

## 边界条件测试

### 测试用例 9.1：零持仓
- **前置条件：** 数据库为空
- **操作：** 打开持仓列表
- **预期结果：**
  - 显示「暂无持仓」提示
  - 显示「添加」按钮引导

### 测试用例 9.2：极大数值
- **操作：** 输入价格 9999.99，数量 999999
- **预期结果：**
  - 能够正常处理
  - 金额格式化显示正确

### 测试用例 9.3：负数输入
- **操作：** 在添加持仓时输入负数
- **预期结果：**
  - 显示错误提示

---

## 兼容性测试

### 测试环境
- [ ] iOS 14+ 真机
- [ ] Android 10+ 真机
- [ ] 微信开发者工具（模拟器）

### 测试要点
- 页面布局在不同屏幕尺寸下的显示
- tabBar 在不同设备上的交互
- 图标显示是否正常

---

## 测试报告模板

```markdown
# 测试报告

**测试日期：** YYYY-MM-DD
**测试人员：** [姓名]
**小程序版本：** 1.0.0

## 测试结果汇总

| 模块 | 测试用例数 | 通过 | 失败 | 通过率 |
|------|-----------|------|------|--------|
| 持仓列表 | 4 | 4 | 0 | 100% |
| 持仓详情 | 3 | 3 | 0 | 100% |
| 添加持仓 | 4 | 4 | 0 | 100% |
| 交易记录 | 2 | 2 | 0 | 100% |
| 设置 | 2 | 2 | 0 | 100% |
| 成本计算 | 4 | 4 | 0 | 100% |
| 云函数 | 3 | 3 | 0 | 100% |
| 性能测试 | 2 | 2 | 0 | 100% |
| 边界测试 | 3 | 3 | 0 | 100% |
| **总计** | **27** | **27** | **0** | **100%** |

## 发现的问题

[记录测试中发现的问题]

## 建议

[记录改进建议]
```

---
